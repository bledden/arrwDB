<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Database System Architecture - Interactive Diagrams</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0d1117;
            --bg-medium: #161b22;
            --bg-light: #21262d;
            --border-color: #30363d;
            --text-primary: #c9d1d9;
            --text-secondary: #8b949e;
            --accent-blue: #58a6ff;
            --accent-green: #3fb950;
            --accent-purple: #bc8cff;
            --accent-orange: #f78166;
            --accent-yellow: #d29922;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans', Helvetica, Arial, sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: var(--bg-medium);
            border-bottom: 1px solid var(--border-color);
            padding: 2rem 2rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--accent-blue), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Navigation */
        .nav {
            display: flex;
            gap: 0.5rem;
            padding: 1rem 2rem;
            background: var(--bg-medium);
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
            position: sticky;
            top: 120px;
            z-index: 99;
        }

        .nav-btn {
            padding: 0.5rem 1rem;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-btn:hover {
            background: var(--bg-dark);
            color: var(--accent-blue);
            border-color: var(--accent-blue);
        }

        .nav-btn.active {
            background: var(--accent-blue);
            color: var(--bg-dark);
            border-color: var(--accent-blue);
            font-weight: 600;
        }

        /* Container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Diagram Card */
        .diagram-card {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeInUp 0.5s forwards;
        }

        @keyframes fadeInUp {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .diagram-card.hidden {
            display: none;
        }

        .diagram-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .diagram-icon {
            font-size: 2rem;
        }

        .diagram-title {
            flex: 1;
        }

        .diagram-title h2 {
            font-size: 1.5rem;
            margin-bottom: 0.25rem;
            color: var(--accent-blue);
        }

        .diagram-title .subtitle {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .badge {
            padding: 0.25rem 0.75rem;
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            font-size: 0.8rem;
            color: var(--accent-green);
        }

        /* Diagram Content */
        .diagram-content {
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 1.5rem;
            overflow-x: auto;
        }

        .diagram-content pre {
            font-family: 'SF Mono', 'Monaco', 'Inconsolata', 'Fira Mono', 'Droid Sans Mono', 'Source Code Pro', monospace;
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--text-primary);
            white-space: pre;
        }

        /* Colorize diagram elements */
        .diagram-content pre {
            background: linear-gradient(135deg, rgba(88, 166, 255, 0.05), rgba(188, 140, 255, 0.05));
        }

        /* Talking Points */
        .talking-points {
            background: var(--bg-light);
            border-left: 4px solid var(--accent-green);
            border-radius: 6px;
            padding: 1.5rem;
        }

        .talking-points h3 {
            color: var(--accent-green);
            font-size: 1rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .talking-points ul {
            list-style: none;
            padding-left: 0;
        }

        .talking-points li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
            color: var(--text-secondary);
        }

        .talking-points li:before {
            content: "â†’";
            position: absolute;
            left: 0;
            color: var(--accent-green);
            font-weight: bold;
        }

        /* Reference Table */
        .reference-table {
            background: var(--bg-light);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
        }

        .reference-table h3 {
            color: var(--accent-purple);
            margin-bottom: 1rem;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        th {
            background: var(--bg-dark);
            color: var(--accent-blue);
            font-weight: 600;
        }

        td {
            color: var(--text-secondary);
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover td {
            background: var(--bg-dark);
            color: var(--text-primary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            color: var(--text-secondary);
            border-top: 1px solid var(--border-color);
            margin-top: 4rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .nav {
                top: 100px;
            }

            .diagram-content {
                padding: 1rem;
                font-size: 0.8rem;
            }

            .container {
                padding: 1rem;
            }
        }

        /* Code highlighting */
        .keyword { color: var(--accent-purple); }
        .string { color: var(--accent-green); }
        .comment { color: var(--text-secondary); font-style: italic; }
        .function { color: var(--accent-blue); }
        .number { color: var(--accent-orange); }

        /* Scroll indicator */
        .scroll-indicator {
            position: fixed;
            top: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--accent-blue), var(--accent-purple));
            z-index: 1000;
            transition: width 0.1s;
        }

        /* Legend */
        .legend {
            background: var(--bg-light);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 2rem;
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
        }

        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 4px;
        }

        .color-api { background: var(--accent-blue); }
        .color-service { background: var(--accent-green); }
        .color-repo { background: var(--accent-purple); }
        .color-infra { background: var(--accent-orange); }
    </style>
</head>
<body>
    <div class="scroll-indicator" id="scrollIndicator"></div>

    <header class="header">
        <h1>ğŸ—ï¸ Vector Database System Architecture</h1>
        <p>Interactive Visual Diagrams for Demo & Interview Preparation</p>
    </header>

    <nav class="nav" id="nav">
        <button class="nav-btn active" data-diagram="all">ğŸ“‹ All Diagrams</button>
        <button class="nav-btn" data-diagram="1">1ï¸âƒ£ High-Level</button>
        <button class="nav-btn" data-diagram="2">2ï¸âƒ£ Detailed</button>
        <button class="nav-btn" data-diagram="3">3ï¸âƒ£ HNSW</button>
        <button class="nav-btn" data-diagram="4">4ï¸âƒ£ R-W Lock</button>
        <button class="nav-btn" data-diagram="5">5ï¸âƒ£ Add Document</button>
        <button class="nav-btn" data-diagram="6">6ï¸âƒ£ Search</button>
        <button class="nav-btn" data-diagram="7">7ï¸âƒ£ Deduplication</button>
        <button class="nav-btn" data-diagram="reference">ğŸ“Š Quick Reference</button>
    </nav>

    <div class="container">
        <!-- Legend -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color color-api"></div>
                <span>API Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-service"></div>
                <span>Service Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-repo"></div>
                <span>Repository Layer</span>
            </div>
            <div class="legend-item">
                <div class="legend-color color-infra"></div>
                <span>Infrastructure</span>
            </div>
        </div>

        <!-- Diagram 1 -->
        <div class="diagram-card" data-diagram-id="1">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 1: High-Level Architecture</h2>
                    <div class="subtitle">Simple 4-layer overview</div>
                </div>
                <span class="badge">Part 2: Architecture</span>
            </div>

            <div class="diagram-content">
                <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    REST API (FastAPI)                        â”‚
â”‚         POST /libraries, /documents, /search                 â”‚
â”‚              Automatic OpenAPI Docs (/docs)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Service Layer (Business Logic)                 â”‚
â”‚         LibraryService    â”‚    EmbeddingService              â”‚
â”‚     (Orchestration)       â”‚    (Cohere Integration)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Repository Layer (Thread-Safe Data Access)          â”‚
â”‚              LibraryRepository + R-W Lock                    â”‚
â”‚     Multiple readers OR single writer (exclusive)            â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚          â”‚          â”‚          â”‚
       â–¼          â–¼          â–¼          â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Vector â”‚ â”‚Index â”‚  â”‚Embed  â”‚  â”‚Persistenceâ”‚
   â”‚ Store  â”‚ â”‚ (4x) â”‚  â”‚Contractâ”‚ â”‚WAL+Snapshotâ”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Four distinct layers, each with single responsibility"</li>
                    <li>"Request flows top to bottom, responses flow back up"</li>
                    <li>"Repository layer is the only place with locks - centralized concurrency control"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 2 -->
        <div class="diagram-card" data-diagram-id="2">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 2: Detailed Component View</h2>
                    <div class="subtitle">Full component breakdown with dependencies</div>
                </div>
                <span class="badge">Part 2 or Part 7</span>
            </div>

            <div class="diagram-content">
                <pre>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        FastAPI Application                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚  â”‚   /health    â”‚  â”‚  /libraries  â”‚  â”‚   /search    â”‚          â”‚
â”‚  â”‚  (endpoint)  â”‚  â”‚  (endpoint)  â”‚  â”‚  (endpoint)  â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚         â”‚                 â”‚                  â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼ Depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LibraryService                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚ â€¢ create_library()                                 â”‚         â”‚
â”‚  â”‚ â€¢ add_document_with_embeddings()                   â”‚         â”‚
â”‚  â”‚ â€¢ search()                                         â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                                        â”‚               â”‚
â”‚         â”‚ Uses                                   â”‚ Uses          â”‚
â”‚         â–¼                                        â–¼               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚EmbeddingService â”‚                  â”‚LibraryRepository â”‚     â”‚
â”‚  â”‚ (Cohere API)    â”‚                  â”‚  (Data Access)   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                   â”‚
                                                   â”‚ Uses
                                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Infrastructure Layer                           â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚              LibraryRepository                     â”‚         â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚         â”‚
â”‚  â”‚   â”‚    ReaderWriterLock (Thread Safety)      â”‚    â”‚         â”‚
â”‚  â”‚   â”‚  â€¢ read(): Multiple concurrent allowed   â”‚    â”‚         â”‚
â”‚  â”‚   â”‚  â€¢ write(): Exclusive access             â”‚    â”‚         â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                  â”‚
â”‚  Coordinates:                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ VectorStore  â”‚ â”‚  Index    â”‚ â”‚ Embedding â”‚ â”‚ Persistence â”‚ â”‚
â”‚  â”‚              â”‚ â”‚ (4 types) â”‚ â”‚ Contract  â”‚ â”‚ (WAL+Snap)  â”‚ â”‚
â”‚  â”‚ â€¢ add_vector â”‚ â”‚ â€¢ HNSW    â”‚ â”‚ â€¢ validateâ”‚ â”‚ â€¢ append_op â”‚ â”‚
â”‚  â”‚ â€¢ get_vector â”‚ â”‚ â€¢ LSH     â”‚ â”‚ â€¢ normalizeâ”‚ â”‚ â€¢ snapshot  â”‚ â”‚
â”‚  â”‚ â€¢ remove     â”‚ â”‚ â€¢ KD-Tree â”‚ â”‚           â”‚ â”‚ â€¢ recover   â”‚ â”‚
â”‚  â”‚ â€¢ dedup      â”‚ â”‚ â€¢ BruteF. â”‚ â”‚           â”‚ â”‚             â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Dependency injection - FastAPI provides LibraryService to endpoints"</li>
                    <li>"Service layer coordinates between embedding generation and data storage"</li>
                    <li>"Repository is the single point of thread safety"</li>
                    <li>"Four pluggable index implementations behind common interface"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 3 -->
        <div class="diagram-card" data-diagram-id="3">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 3: HNSW Graph Structure</h2>
                    <div class="subtitle">Multi-layer navigation visualization</div>
                </div>
                <span class="badge">Part 3: HNSW Deep Dive</span>
            </div>

            <div class="diagram-content">
                <pre>
HNSW Graph Structure - Multi-Layer Navigation
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Layer 2 (Top - Sparse "Highways")
   Node A â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–º Node D
     â†“                                              â†“
     â†“                                              â†“

Layer 1 (Medium Density)
   Node A â”â”â”â”â”â”â”â”â”â–º Node B â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â–º Node D
     â†“                 â†“                            â†“
     â†“                 â†“                            â†“

Layer 0 (Bottom - Dense "City Streets", ALL vectors)
   Node A â”â”â–º Node B â”â”â–º Node C â”â”â–º Node D â”â”â–º Node E
     â†•        â†•         â†•         â†•         â†•
   (local connections between nearest neighbors)


SEARCH EXAMPLE: Finding nearest neighbor to Query Q
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Step 1: Start at Layer 2 (entry point = A)
   Q is closer to D than A
   âœ Jump A â†’ D (long-range connection)

Step 2: Descend to Layer 1 at D
   Q is closer to B than D
   âœ Navigate D â†’ B

Step 3: Descend to Layer 0 at B
   Q is very close to C
   âœ Navigate B â†’ C
   C is nearest neighbor! âœ“

Total hops: 3 (vs checking all 5 nodes with brute force)
Complexity: O(log n) where n = number of vectors


SIMPLIFIED VERSION:
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HNSW = Multi-Layer Graph (Like a Highway Map)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Layer 2: [A]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[D]
         (few nodes, long jumps = highways)

Layer 1: [A]â”€â”€â”€â”€â–º[B]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º[D]
         (medium density = main roads)

Layer 0: [A]â”€â–º[B]â”€â–º[C]â”€â–º[D]â”€â–º[E]
         (all vectors, local = city streets)

Search Strategy: Start at top (A) â†’ Long jump (D)
                 â†’ Descend â†’ Local navigation (Bâ†’C)
                 â†’ Find exact neighbor!

Why it's fast: Navigate mostly at top layers (few nodes)
               Only explore densely at the end (precise)
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Like Google Maps - zoom out for highways, zoom in for streets"</li>
                    <li>"Top layer has maybe 10 nodes out of 10,000 - that's log(n)"</li>
                    <li>"Each hop gets you closer until you find the nearest neighbor"</li>
                    <li>"This is why we get O(log n) - limited hops through hierarchy"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 4 -->
        <div class="diagram-card" data-diagram-id="4">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 4: Reader-Writer Lock Behavior</h2>
                    <div class="subtitle">Concurrent access patterns</div>
                </div>
                <span class="badge">Part 2: Concurrency</span>
            </div>

            <div class="diagram-content">
                <pre>
READER-WRITER LOCK: How Concurrent Access Works
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Scenario 1: Multiple Readers (ALLOWED - No Blocking)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Thread 1 â”‚  â”‚Thread 2 â”‚  â”‚Thread 3 â”‚  â”‚Thread 4 â”‚
â”‚SEARCH   â”‚  â”‚SEARCH   â”‚  â”‚SEARCH   â”‚  â”‚SEARCH   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Read Lock (R)     â”‚  âœ“ All proceed simultaneously
        â”‚   Readers: 4        â”‚  âœ“ No blocking
        â”‚   Writers: 0        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Scenario 2: Writer Arrives (Blocks New Readers)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Thread 1 â”‚  â”‚Thread 2 â”‚  â”‚Thread 3 â”‚  â”‚Thread 4 â”‚
â”‚SEARCH   â”‚  â”‚SEARCH   â”‚  â”‚ INSERT  â”‚  â”‚SEARCH   â”‚
â”‚(active) â”‚  â”‚(active) â”‚  â”‚(waiting)â”‚  â”‚(blocked)â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚            â”‚            â”‚            â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Read Lock (R)                         â”‚
        â”‚   Active Readers: 2 (Thread 1, 2)       â”‚
        â”‚   Waiting Writer: 1 (Thread 3)          â”‚
        â”‚   Blocked Readers: 1 (Thread 4)         â”‚
        â”‚                                          â”‚
        â”‚   Thread 4 must wait for writer!        â”‚
        â”‚   (Writer priority prevents starvation) â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Scenario 3: Writer Executes (Exclusive Access)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚Thread 1 â”‚  â”‚Thread 2 â”‚  â”‚Thread 3 â”‚  â”‚Thread 4 â”‚
â”‚(done)   â”‚  â”‚(done)   â”‚  â”‚ INSERT  â”‚  â”‚SEARCH   â”‚
â”‚         â”‚  â”‚         â”‚  â”‚(active) â”‚  â”‚(blocked)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
                               â”‚            â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚   Write Lock (W) - EXCLUSIVE            â”‚
        â”‚   Active Writers: 1 (Thread 3)          â”‚
        â”‚   Blocked Readers: 1 (Thread 4)         â”‚
        â”‚                                          â”‚
        â”‚   Only ONE writer, everyone else waits  â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


KEY PROPERTIES:
âœ“ Multiple readers = OK (concurrent)
âœ“ Multiple writers = NO (exclusive)
âœ“ Reader + Writer = NO (exclusive)
âœ“ Writer waiting â†’ New readers block (writer priority)
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Read-heavy workload benefits from concurrent reads"</li>
                    <li>"Writer priority prevents updates from starving"</li>
                    <li>"Typical vector DB: 90% searches (reads), 10% inserts (writes)"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 5 -->
        <div class="diagram-card" data-diagram-id="5">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 5: Add Document Request Flow</h2>
                    <div class="subtitle">Complete request lifecycle</div>
                </div>
                <span class="badge">Part 5: Live Demo</span>
            </div>

            <div class="diagram-content">
                <pre>
USER ADDS A DOCUMENT - Full Request Flow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Client Request
   POST /v1/libraries/{lib_id}/documents
   {
     "title": "ML Tutorial",
     "texts": ["ML is...", "Supervised learning..."]
   }
              â”‚
              â–¼
2. FastAPI Endpoint
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ POST /documents endpoint        â”‚
   â”‚ â€¢ Validates request (Pydantic)  â”‚
   â”‚ â€¢ Extracts library_id, texts    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼
3. Service Layer
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LibraryService                  â”‚
   â”‚ â€¢ Calls EmbeddingService        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚
            â”‚           â””â”€â”€â”€â”€â”€â”€â–º â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚                    â”‚ EmbeddingService   â”‚
            â”‚                    â”‚ â€¢ Calls Cohere API â”‚
            â”‚                    â”‚ â€¢ Returns vectors  â”‚
            â”‚                    â”‚   [0.1, 0.2, ...]  â”‚
            â”‚           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚           â”‚
            â–¼           â–¼
4. Repository Layer
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ LibraryRepository.add_document()     â”‚
   â”‚ â€¢ Acquires WRITE lock                â”‚
   â”‚ â€¢ Blocks all readers & writers       â”‚
   â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
   â”‚         while write is active       â”‚â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
            â”‚                              â”‚
            â–¼                              â”‚
5. Persistence (WAL)                       â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ WriteAheadLog.append_operation() â”‚   â”‚
   â”‚ â€¢ Logs: "ADD_DOCUMENT lib=X"     â”‚   â”‚
   â”‚ â€¢ fsync() to disk (durable)      â”‚   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚                          â”‚
                â–¼                          â”‚
6. Vector Storage                          â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ VectorStore.add_vector()         â”‚   â”‚
   â”‚ â€¢ Hash vector (dedup check)      â”‚   â”‚
   â”‚ â€¢ Store if new, ref++ if exists  â”‚   â”‚
   â”‚ â€¢ Returns vector index           â”‚   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚                          â”‚
                â–¼                          â”‚
7. Index Update                            â”‚
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
   â”‚ HNSWIndex.add_vector()           â”‚   â”‚
   â”‚ â€¢ Assign layer (exponential)     â”‚   â”‚
   â”‚ â€¢ Find M nearest neighbors       â”‚   â”‚
   â”‚ â€¢ Create bidirectional edges     â”‚   â”‚
   â”‚ â€¢ Update graph structure         â”‚   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
                â”‚                          â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚
                â–¼ Release WRITE lock
8. Response
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ 201 Created                      â”‚
   â”‚ {                                â”‚
   â”‚   "id": "doc-uuid",              â”‚
   â”‚   "title": "ML Tutorial",        â”‚
   â”‚   "chunks": [...]                â”‚
   â”‚ }                                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TOTAL TIME: ~100-200ms
â€¢ Cohere API: ~80ms (external)
â€¢ HNSW insert: ~3-5ms per vector
â€¢ WAL write: ~1ms (fsync)
â€¢ Serialization: ~10ms
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Six layers of abstraction, each with clear responsibility"</li>
                    <li>"WAL ensures durability before applying changes"</li>
                    <li>"Write lock guarantees no concurrent modifications"</li>
                    <li>"HNSW graph updated incrementally, no full rebuild"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 6 -->
        <div class="diagram-card" data-diagram-id="6">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 6: Search Operation Flow</h2>
                    <div class="subtitle">Search request lifecycle with timing</div>
                </div>
                <span class="badge">Part 5: Live Demo</span>
            </div>

            <div class="diagram-content">
                <pre>
USER SEARCHES - Request Flow
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. Query: "How does supervised learning work?"
              â”‚
              â–¼
2. Embed Query (Cohere API)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ EmbeddingService.embed_text()      â”‚
   â”‚ Input: "How does supervised..."    â”‚
   â”‚ Output: [0.15, 0.32, ..., 0.08]    â”‚
   â”‚         (1024-dim vector)          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
3. Search Index (HNSW)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Repository.search() [READ lock]    â”‚
   â”‚ â€¢ Multiple searches can run now    â”‚
   â”‚ â€¢ No writers active                â”‚
   â”‚                                    â”‚
   â”‚ HNSWIndex.search(query, k=10)      â”‚
   â”‚ Layer 2: Start at entry, navigate â”‚
   â”‚ Layer 1: Descend, narrow search   â”‚
   â”‚ Layer 0: Find exact k=10 neighborsâ”‚
   â”‚                                    â”‚
   â”‚ Returns: [(chunk_id, distance)]   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
4. Fetch Chunk Text
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Map vector IDs â†’ Chunks            â”‚
   â”‚ chunk_id_1 â†’ "Supervised learning..."â”‚
   â”‚ chunk_id_2 â†’ "ML is a subset..."  â”‚
   â”‚ chunk_id_3 â†’ "Neural networks..."  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
5. Return Results (Ranked)
   [
     {
       "text": "Supervised learning uses...",
       "distance": 0.12,  â† Most similar
       "document": "ML Tutorial"
     },
     {
       "text": "ML is a subset...",
       "distance": 0.35,
       "document": "ML Tutorial"
     }
   ]

TOTAL TIME: ~85-90ms
â€¢ Embed query: ~80ms (Cohere)
â€¢ HNSW search: 1-3ms â† THIS IS THE FLEX!
â€¢ Fetch text: <1ms
â€¢ Serialize: ~5ms
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Search is mostly embedding time (80ms) + network"</li>
                    <li>"HNSW search itself is sub-3ms - that's the algorithmic win"</li>
                    <li>"Multiple searches run concurrently (READ lock)"</li>
                    <li>"Results ranked by distance (lower = more similar)"</li>
                </ul>
            </div>
        </div>

        <!-- Diagram 7 -->
        <div class="diagram-card" data-diagram-id="7">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“</div>
                <div class="diagram-title">
                    <h2>Diagram 7: Memory Efficiency (Deduplication)</h2>
                    <div class="subtitle">Before/after memory comparison</div>
                </div>
                <span class="badge">Part 4: Production Features</span>
            </div>

            <div class="diagram-content">
                <pre>
VECTOR DEDUPLICATION - Memory Savings
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

WITHOUT Deduplication (Naive):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Document 1: "Copyright 2024..."                 â”‚
â”‚   Chunk 1 â†’ [0.5, 0.2, ...] (4KB)              â”‚
â”‚   Chunk 2 â†’ [0.1, 0.8, ...] (4KB)              â”‚
â”‚                                                 â”‚
â”‚ Document 2: "Copyright 2024..."  â† Same text!  â”‚
â”‚   Chunk 3 â†’ [0.5, 0.2, ...] (4KB) â† Duplicate! â”‚
â”‚   Chunk 4 â†’ [0.3, 0.7, ...] (4KB)              â”‚
â”‚                                                 â”‚
â”‚ Document 3: "Copyright 2024..."  â† Same again! â”‚
â”‚   Chunk 5 â†’ [0.5, 0.2, ...] (4KB) â† Duplicate! â”‚
â”‚   Chunk 6 â†’ [0.6, 0.1, ...] (4KB)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total: 6 chunks Ã— 4KB = 24KB


WITH Deduplication (My Implementation):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ VectorStore (Reference Counted):                â”‚
â”‚                                                 â”‚
â”‚ Vector 0: [0.5, 0.2, ...] â†’ ref_count = 3      â”‚
â”‚           â†‘       â†‘        â†‘                    â”‚
â”‚   Chunk 1 â”˜       â”‚        â”‚                    â”‚
â”‚          Chunk 3 â”€â”˜        â”‚                    â”‚
â”‚                 Chunk 5 â”€â”€â”€â”˜                    â”‚
â”‚                                                 â”‚
â”‚ Vector 1: [0.1, 0.8, ...] â†’ ref_count = 1      â”‚
â”‚           â†‘                                     â”‚
â”‚   Chunk 2 â”˜                                     â”‚
â”‚                                                 â”‚
â”‚ Vector 2: [0.3, 0.7, ...] â†’ ref_count = 1      â”‚
â”‚           â†‘                                     â”‚
â”‚   Chunk 4 â”˜                                     â”‚
â”‚                                                 â”‚
â”‚ Vector 3: [0.6, 0.1, ...] â†’ ref_count = 1      â”‚
â”‚           â†‘                                     â”‚
â”‚   Chunk 6 â”˜                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
Total: 4 unique vectors Ã— 4KB = 16KB
Savings: (24KB - 16KB) / 24KB = 33%

In my tests: 48% savings!
                </pre>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Talking Points</h3>
                <ul>
                    <li>"Repeated text is common: headers, footers, disclaimers"</li>
                    <li>"Store vector once, multiple chunks reference it"</li>
                    <li>"Reference counting tracks usage, frees when count â†’ 0"</li>
                    <li>"Real-world benefit: 48% less memory in validation tests"</li>
                </ul>
            </div>
        </div>

        <!-- Reference Table -->
        <div class="diagram-card" data-diagram-id="reference">
            <div class="diagram-header">
                <div class="diagram-icon">ğŸ“Š</div>
                <div class="diagram-title">
                    <h2>Quick Reference: Which Diagram When</h2>
                    <div class="subtitle">Usage guide for demo video</div>
                </div>
            </div>

            <div class="reference-table">
                <table>
                    <thead>
                        <tr>
                            <th>Video Section</th>
                            <th>Best Diagram</th>
                            <th>Why</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Part 1: Intro</td>
                            <td>Diagram 1 (Simple)</td>
                            <td>Quick overview</td>
                        </tr>
                        <tr>
                            <td>Part 2: Architecture</td>
                            <td>Diagram 2 or 4</td>
                            <td>Show layers + concurrency</td>
                        </tr>
                        <tr>
                            <td>Part 3: HNSW</td>
                            <td>Diagram 3 (Visual)</td>
                            <td>Core algorithm</td>
                        </tr>
                        <tr>
                            <td>Part 4: Prod Features</td>
                            <td>Diagram 7 (Memory)</td>
                            <td>Show dedup benefit</td>
                        </tr>
                        <tr>
                            <td>Part 5: Live Demo</td>
                            <td>Diagram 5 or 6</td>
                            <td>Request flow</td>
                        </tr>
                        <tr>
                            <td>Part 6: Testing</td>
                            <td>None needed</td>
                            <td>Just show results</td>
                        </tr>
                        <tr>
                            <td>Part 7: Wrap-up</td>
                            <td>Diagram 1 again</td>
                            <td>Bookend the demo</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="talking-points">
                <h3>ğŸ’¡ Usage Tips</h3>
                <ul>
                    <li><strong>For Technical Interviewers:</strong> Use Diagrams 2, 3, 4, 5, 6 (detailed)</li>
                    <li><strong>For Non-Technical:</strong> Use Diagrams 1, 3 (simplified versions)</li>
                    <li><strong>For Demo Video:</strong> Use Diagram 1 + Diagram 3 as minimum. Others are backup.</li>
                    <li><strong>Recommendation:</strong> Diagram 1 + Diagram 3 (HNSW) tell the complete story</li>
                </ul>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>ğŸ—ï¸ Vector Database System Architecture Diagrams</p>
        <p>Created for demo video and interview preparation</p>
    </footer>

    <script>
        // Navigation
        const navButtons = document.querySelectorAll('.nav-btn');
        const diagramCards = document.querySelectorAll('.diagram-card');

        navButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const targetDiagram = btn.dataset.diagram;

                // Update active button
                navButtons.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                // Show/hide diagrams
                diagramCards.forEach(card => {
                    const cardId = card.dataset.diagramId;
                    if (targetDiagram === 'all') {
                        card.classList.remove('hidden');
                    } else if (cardId === targetDiagram) {
                        card.classList.remove('hidden');
                    } else {
                        card.classList.add('hidden');
                    }
                });

                // Scroll to top smoothly
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
        });

        // Scroll indicator
        window.addEventListener('scroll', () => {
            const scrollIndicator = document.getElementById('scrollIndicator');
            const windowHeight = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (window.scrollY / windowHeight) * 100;
            scrollIndicator.style.width = scrolled + '%';
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '7') {
                const index = parseInt(e.key);
                navButtons[index].click();
            }
            if (e.key === '0') {
                navButtons[0].click(); // All diagrams
            }
        });

        // Print message
        console.log('%cğŸ—ï¸ Vector Database System Architecture', 'font-size: 20px; font-weight: bold; color: #58a6ff;');
        console.log('%cKeyboard shortcuts: Press 0-7 to navigate diagrams', 'color: #8b949e;');
    </script>
</body>
</html>